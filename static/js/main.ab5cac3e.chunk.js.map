{"version":3,"sources":["audio.js","stats.js","serviceWorker.js","shaders.js","menu.js","index.js"],"names":["getMicMediaStream","a","constraints","audio","videol","navigator","mediaDevices","getUserMedia","console","log","webkitGetUserMedia","Promise","resolve","reject","micSource","mediaStream","context","newAudioContext","source","createMediaStreamSource","stream","fileSource","document","createElement","sourceEl","src","process","appendChild","createMediaElementSource","connect","destination","window","AudioContext","webkitAudioContext","reqId","makeStats","stats","Stats","showFpsCounter","enabled","body","dom","style","right","left","requestAnimationFrame","loop","update","cancelAnimationFrame","undefined","removeChild","Boolean","location","hostname","match","Menu","app","this","el","getElementById","playback","progress","mic","toggle","fullscreen","info","addEventListener","_toggleFullscreen","_toggleMicrophone","_togglePlayback","_toggleControls","_toggleInfo","event","keyCode","key","className","_toggle","useMic","stopMic","useAudio","value","Math","round","currentTime","duration","fullscreenElement","documentElement","requestFullscreen","exitFullscreen","serviceWorker","ready","then","registration","unregister","catch","error","message","GlAttractor","fragmentShaderCode","vertexShaderCode","numPoints","canvas","setWidth","min","innerHeight","innerWidth","setHeight","width","setMargin","height","margin","gl","getContext","antialias","depth","program","compileShaders","useProgram","useVertexBuffer","rootEl","devicePixelRatio","vertexShader","createShader","VERTEX_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","fragmentShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","array","Float32Array","map","random","vertexBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","a_position","getAttribLocation","vertexAttribPointer","FLOAT","enableVertexAttribArray","b","c","d","color","u_a","getUniformLocation","u_b","u_c","u_d","u_color","uniform1f","drawArrays","POINTS","SoundMapper","energy","features","analyzer","ts","get","_energyBin","_oscillation","_getColor","_getD","flatness","sin","floor","App","points","pow","attractor","file","playbackActive","pause","paused","_makeAnalyzer","state","close","getTracks","forEach","track","stop","play","resume","Meyda","createMeydaAnalyzer","audioContext","bufferSize","windowingFunction","featureExtractors","onload","loadFile","mapper","timestamp","uniforms","getUniforms","setUniforms","draw"],"mappings":"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","file":"static/js/main.ab5cac3e.chunk.js","sourcesContent":["async function getMicMediaStream() {\n  const constraints = { audio: true, videol: false };\n  if (navigator.mediaDevices.getUserMedia) {\n    console.log(\"Using navigator.mediaDevices\");\n    return navigator.mediaDevices.getUserMedia(constraints);\n  } else if (navigator.webkitGetUserMedia || navigator.getUserMedia) {\n    navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia;\n    return new Promise((resolve, reject) => {\n      navigator.getUserMedia(constraints, resolve, reject);\n    });\n  }\n}\n\nexport async function micSource() {\n  const mediaStream = await getMicMediaStream();\n  const context = newAudioContext();\n  return { context, source: context.createMediaStreamSource(mediaStream), stream: mediaStream};\n};\n\n\nexport async function fileSource() {\n  const audio = document.createElement('audio');\n  const sourceEl = document.createElement('source');\n  sourceEl.src = process.env.PUBLIC_URL + \"/max-cooper-fragments-of-self-sample.mp3\";\n  audio.appendChild(sourceEl);\n  const context = newAudioContext();\n  const source = context.createMediaElementSource(audio);\n  source.connect(context.destination);\n  return { context, source, audio };\n}\n\nfunction newAudioContext() {\n  const AudioContext = window.AudioContext // Default\n  || window.webkitAudioContext // Safari and old versions of Chrome\n  || false;\n  return new AudioContext();\n}\n","import Stats from \"stats.js\";\n\nfunction makeStats() {\n  // poor man's run once\n  if (makeStats.stats) return makeStats.stats;\n  makeStats.stats = new Stats();\n  return makeStats.stats;\n}\n\nlet reqId;\nexport const showFpsCounter = enabled => {\n  const stats = makeStats();\n  if (enabled && !reqId) {\n    document.body.appendChild(stats.dom);\n    stats.dom.style.right = 0;\n    stats.dom.style.left = null;\n    reqId = requestAnimationFrame(function loop() {\n      stats.update();\n      reqId = requestAnimationFrame(loop);\n    });\n  } else if (!enabled && reqId) {\n    cancelAnimationFrame(reqId);\n    reqId = undefined;\n    document.body.removeChild(stats.dom);\n  }\n};\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","export const fragmentShaderCode = `\nprecision highp float;\n\nuniform float u_color;\n\nvarying float v_t;\n\nconst float PI = 3.14159265359;\n\nvec3 cubehelix(float x, float y, float z) {\n  float a = y * z * (1.0 - z);\n  float c = cos(x + PI / 2.0);\n  float s = sin(x + PI / 2.0);\n  return vec3(\n    z + a * (1.78277 * s - 0.14861 * c),\n    z - a * (0.29227 * c + 0.90649 * s),\n    z + a * (1.97294 * c)\n  );\n}\n\nvec3 rainbow(float t) {\n  if (t < 0.0 || t > 1.0) t -= floor(t);\n  float ts = abs(t - 0.5);\n  return cubehelix(\n    (360.0 * t - 100.0) / 180.0 * PI,\n    1.5 - 1.5 * ts,\n    u_color - 0.9 * ts\n  );\n}\n\nvoid main() {\n  gl_FragColor = vec4(rainbow(v_t / 4.0 + 0.25), 1.0);\n}\n`;\n\nexport const vertexShaderCode = `\nprecision highp float;\n\nconst float PI = 3.14159265359;\n\nuniform float u_a;\nuniform float u_b;\nuniform float u_c;\nuniform float u_d;\n\nattribute vec2 a_position;\n\nvarying float v_t;\n\nvoid main() {\nfloat x1, x2 = a_position.x;\nfloat y1, y2 = a_position.y;\nfor (int i = 0; i < 8; i++) {\n  x1 = x2, y1 = y2;\n  x2 = sin(u_a * y1) - cos(u_b * x1);\n  y2 = sin(u_c * x1) - cos(u_d * y1);\n}\nv_t = atan(a_position.y, a_position.x) / PI;\ngl_Position = vec4(x2 / 2.0, y2 / 2.0, 0.0, 1.0);\ngl_PointSize = 1.5;\n}\n`;\n","import { showFpsCounter } from \"./stats\";\n\nexport class Menu {\n  constructor(app) {\n    this.app = app;\n    this.el = document.getElementById('menu');\n\n    this.playback = document.getElementById('playback');\n    this.progress = document.getElementById('progress');\n    this.mic = document.getElementById('mic');\n    this.toggle = document.getElementById('toggle-controls');\n    this.fullscreen = document.getElementById('fullscreen');\n    this.info = document.getElementById('info');\n\n    this.fullscreen.addEventListener('click', () => this._toggleFullscreen());\n    this.mic.addEventListener('click', async () => await this._toggleMicrophone());\n    this.playback.addEventListener('click', () => this._togglePlayback());\n    this.toggle.addEventListener('click', () => this._toggleControls());\n    this.info.addEventListener('click', () => this._toggleInfo());\n\n    document.addEventListener('keypress', async (event) => {\n      if (event.keyCode === 104 || event.key === \"h\") {\n        this._toggleControls();\n      } else if (event.keyCode === 103 || event.key === \"f\") {\n        this._toggleFullscreen();\n      } else if (event.keyCode === 109 || event.key === \"m\") {\n        await this._toggleMicrophone();\n      } else if (event.keyCode === 112 || event.key === \"p\") {\n        this._togglePlayback();\n      } else if (event.keyCode === 105 || event.key === \"i\") {\n        this._toggleInfo();\n      }\n    });\n    // prevents FOUC\n    this.el.className = '';\n  }\n\n  async _toggleMicrophone() {\n    const active = this._toggle(this.mic);\n    if (active) {\n      this.progress.className = 'hide';\n      await this.app.useMic();\n    } else {\n      this.app.stopMic();\n    }\n    this.playback.className = 'off';\n  }\n\n  _togglePlayback() {\n    this._toggle(this.playback);\n    this.mic.className = 'off';\n    const audio = this.app.useAudio();\n    this.progress.className = '';\n    // TODO: check if handler is duplicated\n    audio.addEventListener('timeupdate', () => {\n      // console.log(audio.currentTime, audio.duration, audio.currentTime / audio.duration)\n      this.progress.value = Math.round((audio.currentTime / audio.duration) * 100);\n      // this.playback.setAttribute('data-progress', audio.currentTime / audio.duration);\n    });\n  }\n\n  _toggleInfo() {\n    const info = document.getElementById('info-box');\n    if (info.className === 'hide') {\n      info.className = '';\n    } else {\n      info.className = 'hide';\n    }\n  }\n\n  _toggleControls() {\n    if (this.el.className === 'hide') {\n      showFpsCounter(true);\n      this.el.className = '';\n    } else {\n      showFpsCounter(false);\n      this.el.className = 'hide';\n    }\n  }\n\n  _toggleFullscreen() {\n    const active = this._toggle(this.fullscreen);\n    if (active && !document.fullscreenElement) {\n      document.documentElement.requestFullscreen();\n    } else {\n      if (document.exitFullscreen) {\n        document.exitFullscreen();\n      }\n    }\n  }\n\n  _toggle(el) {\n    if (el.className === 'on') {\n      el.className = 'off';\n    } else {\n      el.className = 'on';\n    }\n    return el.className === 'on';\n  }\n}\n","import Meyda from 'meyda';\n\nimport { micSource, fileSource } from './audio';\nimport { showFpsCounter } from \"./stats\";\nimport './index.css';\nimport * as serviceWorker from './serviceWorker';\nimport { fragmentShaderCode, vertexShaderCode } from './shaders';\nimport { Menu } from './menu';\n\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n\nclass GlAttractor {\n  constructor(fragmentShaderCode, vertexShaderCode, numPoints) {\n    this.canvas = document.createElement('canvas');\n    this.setWidth(Math.min(window.innerHeight, window.innerWidth));\n    this.setHeight(this.width);\n    this.setMargin((window.innerHeight - this.height) / 2)\n    this.canvas.style = `width: ${this.width}px; height: ${this.height}px; margin: ${this.margin};`;\n    this.gl = this.canvas.getContext(\"webgl\", {antialias: true, depth: false});\n    this.program = this.compileShaders(fragmentShaderCode, vertexShaderCode);\n    this.gl.useProgram(this.program);\n    this.numPoints = numPoints;\n    this.useVertexBuffer();\n\n    const rootEl = document.getElementById(\"root\");\n    rootEl.style = `width: ${this.width}px; height: ${this.height}px`;\n    rootEl.appendChild(this.canvas);\n  }\n\n  setWidth(width) {\n    this.width = width;\n    this.canvas.width = width * devicePixelRatio;\n    this.canvas.style = this.canvas.style + `width: ${width}px;`;\n  }\n\n  setHeight(height) {\n    this.height = height;\n    this.canvas.height = height * devicePixelRatio;\n    this.canvas.style = this.canvas.style + `height: ${height}px;`;\n  }\n\n  setMargin(margin) {\n    this.margin = margin;\n    this.canvas.style = this.canvas.style + `margin: ${margin} auto;`;\n  }\n\n  compileShaders(fragmentShaderCode, vertexShaderCode) {\n    const gl = this.gl;\n    const vertexShader = gl.createShader(gl.VERTEX_SHADER);\n    gl.shaderSource(vertexShader, vertexShaderCode);\n    gl.compileShader(vertexShader);\n    if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) throw gl.getShaderInfoLog(vertexShader);\n\n    const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(fragmentShader, fragmentShaderCode);\n    gl.compileShader(fragmentShader);\n    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) throw gl.getShaderInfoLog(fragmentShader);\n\n    const program = gl.createProgram();\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n    gl.linkProgram(program);\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) throw gl.getProgramInfoLog(program);\n\n    return program;\n  }\n\n  useVertexBuffer() {\n    const gl = this.gl;\n    const array = new Float32Array(this.numPoints * 2).map(() => Math.random() * 2 - 1);\n    const vertexBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, array, gl.STATIC_DRAW);\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\n    const a_position = gl.getAttribLocation(this.program, \"a_position\");\n    gl.vertexAttribPointer(a_position, 2, gl.FLOAT, false, 0, 0);\n    gl.enableVertexAttribArray(a_position);\n  }\n\n  setUniforms(a, b, c, d, color) {\n    const u_a = this.gl.getUniformLocation(this.program, \"u_a\")\n    const u_b = this.gl.getUniformLocation(this.program, \"u_b\")\n    const u_c = this.gl.getUniformLocation(this.program, \"u_c\")\n    const u_d = this.gl.getUniformLocation(this.program, \"u_d\")\n    const u_color = this.gl.getUniformLocation(this.program, \"u_color\")\n    this.gl.uniform1f(u_a, a);\n    this.gl.uniform1f(u_b, b);\n    this.gl.uniform1f(u_c, c);\n    this.gl.uniform1f(u_d, d);\n    this.gl.uniform1f(u_color, color);\n  }\n\n  draw() {\n    const gl = this.gl;\n    gl.drawArrays(gl.POINTS, 0, this.numPoints);\n  }\n}\n\nclass SoundMapper {\n  constructor() {\n    this.energy = 0;\n    this.features = {};\n  }\n\n  getUniforms(analyzer, ts) {\n    if (analyzer) {\n      const features = analyzer.get([\"energy\", \"spectralFlatness\"]);\n      if (features) {\n        this.energy += features.energy;\n        this.features = features;\n      } else {\n        this.features = {};\n      }\n    }\n    switch (this._energyBin() % 10) {\n      case 1:\n      case 4:\n      case 7:\n        return [-2.0, this._oscillation(ts)-2.0, -1.2, 2.0, this._getColor(ts)]\n      case 2:\n      case 5:\n        return [-2.0, -2.53, this._oscillation(ts)-1.61, 2.0, this._getColor(ts)]\n      default:\n        return [this._oscillation(ts) - 2.0, -2.0, -1.2, this._getD(), this._getColor(ts)]\n    }\n  }\n\n  _getD() {\n    return (this.features.flatness < .05) ? 2.0 - this.features.energy : 2.0;\n  }\n\n  _getColor(ts) {\n    if (this.features.energy < .5) {\n      return .0;\n    } else if (this.features.energy < 2) {\n      return Math.min(.8, (Math.sin(ts / 8000) + 1) / 2);\n    } else {\n      return .8;\n    }\n  }\n\n  _energyBin() {\n    return Math.floor(this.energy / 100);\n  }\n\n  _oscillation(ts) {\n    return Math.sin(this.energy / 100 + ts / 10000);\n  }\n}\n\nclass App {\n  constructor() {\n    const points = devicePixelRatio > 1 ? Math.pow(2, 20) : Math.pow(2, 19);\n    this.attractor = new GlAttractor(fragmentShaderCode, vertexShaderCode, points);\n  }\n\n  async loadFile() {\n    this.file = await fileSource();\n  }\n\n  async useMic() {\n    const {context, source, stream} = await micSource();\n    if (this.playbackActive) {\n      this.playbackActive = false;\n      this.audio.pause();\n      this.paused = true;\n    }\n\n    this.stream = stream;\n    this.context = context;\n    this.analyzer = this._makeAnalyzer(context, source);\n  }\n\n  stopMic() {\n    this.analyzer = null;\n    if (this.context && this.context.state === 'running') {\n      console.log(this.context.state);\n      this.context.close();\n    }\n    if (this.stream) {\n      this.stream.getTracks().forEach(track => track.stop());\n      this.stream = null;\n    }\n  }\n\n  useAudio() {\n    if (this.playbackActive) {\n      if (this.paused) {\n        console.log('play');\n        this.audio.play();\n        this.paused = false;\n      } else {\n        console.log('pause');\n        this.audio.pause();\n        this.paused = true;\n      }\n    } else {\n      this.stopMic();\n      this.audio = this.file.audio;\n      this.context = this.file.context;\n      this.analyzer = this._makeAnalyzer(this.context, this.file.source);\n      this.playbackActive = true;\n      this.paused = false;\n      this.audio.play();\n      if (this.context.state === 'suspended') {\n        this.context.resume();\n        console.log('resume + play');\n      }\n    }\n    return this.audio;\n  }\n\n  _makeAnalyzer(context, source) {\n    return Meyda.createMeydaAnalyzer({\n      audioContext: context,\n      bufferSize: 512,\n      source,\n      windowingFunction: 'blackman',\n      // perceptualSharpness, zcr, rms\n      featureExtractors: [\"energy\", \"spectralFlatness\"],\n    });\n  }\n}\n\nwindow.onload = async function onLoad() {\n  showFpsCounter(true);\n  const app = new App();\n  await app.loadFile();\n  const mapper = new SoundMapper();\n  new Menu(app);\n  requestAnimationFrame(function loop(timestamp) {\n    const uniforms = mapper.getUniforms(app.analyzer, timestamp);\n    app.attractor.setUniforms(...uniforms);\n    app.attractor.draw();\n\n    // document.getElementById(\"meyda-debug\").innerHTML = `${Math.floor(mapper.energy)} ${Math.floor(mapper.features.energy)}`;\n    requestAnimationFrame(loop);\n  });\n};\n"],"sourceRoot":""}